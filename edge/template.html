<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{TITLE}}</title>
    <link rel="stylesheet" href="../common.css" />
    <!-- Chart.jsの読み込み -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  </head>
  <body>
    <div class="nav-container">
      <ul class="main-nav">
        <li>
          <a href="../chapter1/index.html" {{ACTIVE_CHAPTER1}}
            >Chapter 1: ブラウザのメモリ管理の基本</a
          >
        </li>
        <li>
          <a href="../chapter2/index.html" {{ACTIVE_CHAPTER2}}
            >Chapter 2: メモリリークの検出</a
          >
        </li>
        <li>
          <a href="../chapter3/index.html" {{ACTIVE_CHAPTER3}}
            >Chapter 3: パフォーマンス分析</a
          >
        </li>
        <li>
          <a href="../chapter4/index.html" {{ACTIVE_CHAPTER4}}
            >Chapter 4: 高度なメモリ最適化</a
          >
        </li>
      </ul>
    </div>

    <h1>{{TITLE}}</h1>

    <div class="container" id="browserInfo">
      <h2>ブラウザ情報</h2>
      <div class="memory-info">
        <div class="memory-item">
          <h3>ブラウザ名</h3>
          <div id="browserName" class="memory-value">検出中...</div>
        </div>
        <div class="memory-item">
          <h3>バージョン</h3>
          <div id="browserVersion" class="memory-value">検出中...</div>
        </div>
        <div class="memory-item">
          <h3>メモリAPI対応</h3>
          <div id="memoryApiSupport" class="memory-value">確認中...</div>
        </div>
        <div class="memory-item">
          <h3>監視状態</h3>
          <div class="memory-value">
            <span
              id="monitoringStatus"
              class="status-indicator inactive"
            ></span>
            <span id="monitoringStatusText">停止中</span>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <h2>メモリ使用状況</h2>

      <div class="memory-bar-container">
        <div id="memoryBarDisplay" class="memory-bar"></div>
        <div id="memoryBarLabel" class="memory-bar-label">0%</div>
      </div>

      <div class="memory-info">
        <div class="memory-item">
          <h3>総JSヒープサイズ</h3>
          <div id="totalHeapSize" class="memory-value">計測中...</div>
          <div class="tooltip">
            <span>?</span>
            <span class="tooltip-text"
              >JavaScriptエンジンが確保している総メモリ量</span
            >
          </div>
        </div>
        <div class="memory-item">
          <h3>使用中のJSヒープサイズ</h3>
          <div id="usedHeapSize" class="memory-value">計測中...</div>
          <div class="tooltip">
            <span>?</span>
            <span class="tooltip-text">現在使用中のJavaScriptメモリ量</span>
          </div>
        </div>
        <div class="memory-item">
          <h3>JSヒープサイズ上限</h3>
          <div id="heapSizeLimit" class="memory-value">計測中...</div>
          <div class="tooltip">
            <span>?</span>
            <span class="tooltip-text">JavaScriptが使用できるメモリの上限</span>
          </div>
        </div>
        <div class="memory-item">
          <h3>使用率</h3>
          <div id="memoryUsage" class="memory-value">計測中...</div>
          <div class="tooltip">
            <span>?</span>
            <span class="tooltip-text">上限に対する現在の使用率</span>
          </div>
        </div>
      </div>

      <div class="memory-info">
        <div class="memory-item">
          <h3>最終更新</h3>
          <div id="lastUpdated" class="memory-value">-</div>
        </div>
      </div>

      <div class="controls">
        <button id="startMonitoring" class="success">メモリ監視開始</button>
        <button id="stopMonitoring" class="warning">メモリ監視停止</button>
        <button id="createObject" class="danger">10MBオブジェクト作成</button>
        <button id="clearHistory">履歴クリア</button>
        <button id="exportData">データエクスポート</button>
      </div>
    </div>

    <div class="container">
      <h2>メモリ使用状況グラフ</h2>
      <div class="chart-container">
        <canvas id="memoryChart"></canvas>
      </div>
    </div>

    <div class="container" id="memoryStats">
      <h2>メモリ統計情報</h2>
      <div class="memory-info">
        <div class="memory-item">
          <h3>最小値</h3>
          <div id="memoryMin" class="memory-value">-</div>
        </div>
        <div class="memory-item">
          <h3>最大値</h3>
          <div id="memoryMax" class="memory-value">-</div>
        </div>
        <div class="memory-item">
          <h3>平均値</h3>
          <div id="memoryAvg" class="memory-value">-</div>
        </div>
        <div class="memory-item">
          <h3>直近の変化率</h3>
          <div id="memoryChangeRate" class="memory-value">-</div>
        </div>
        <div class="memory-item">
          <h3>サンプル数</h3>
          <div id="memorySamples" class="memory-value">0</div>
        </div>
      </div>
    </div>

    <div class="container">
      <h2>メモリ監視ログ</h2>
      <div id="memoryLog" class="log-container">
        <!-- ログエントリがここに追加されます -->
      </div>
    </div>

    {{CHAPTER_SPECIFIC_CONTENT}}

    <div class="container">
      <h2>使い方</h2>
      <p>
        このページでは、Edgeブラウザのメモリ使用状況をリアルタイムで監視できます。
      </p>
      <ul>
        <li>
          <strong>メモリ監視開始</strong>: 1秒ごとにメモリ使用状況を更新します
        </li>
        <li><strong>メモリ監視停止</strong>: メモリ監視を停止します</li>
        <li>
          <strong>10MBオブジェクト作成</strong>:
          10MBのオブジェクトを作成してメモリ使用量の変化を確認します
        </li>
        <li>
          <strong>履歴クリア</strong>:
          記録されたメモリ使用状況の履歴をクリアします
        </li>
        <li>
          <strong>データエクスポート</strong>:
          メモリ使用状況の履歴をJSONファイルとしてエクスポートします
        </li>
      </ul>
      <p>
        <strong>注意</strong>:
        <code>performance.memory</code>
        APIはChromiumベースのブラウザ（Chrome、Edge）でのみ利用可能です。
      </p>
      <p>
        <button id="resetTutorial">チュートリアルをリセット</button>
      </p>
    </div>

    <!-- チュートリアル -->
    <div id="tutorialContainer" class="tutorial-container hidden">
      <div class="tutorial-header">
        <h3 id="tutorialTitle">ようこそ</h3>
        <button id="tutorialClose" class="tutorial-close">×</button>
      </div>
      <div id="tutorialContent" class="tutorial-content">
        チュートリアルの内容がここに表示されます。
      </div>
      <div class="tutorial-navigation">
        <button id="tutorialPrev" disabled>前へ</button>
        <button id="tutorialNext">次へ</button>
      </div>
    </div>

    <!-- スクリプト -->
    <script src="../common.js"></script>
    <script src="../chart.js"></script>
    <script src="../tutorial.js"></script>
    <script src="index.js"></script>
  </body>
</html>
