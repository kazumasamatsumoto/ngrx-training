<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NgRx Selectors Visualization</title>
    <style>
      body {
        font-family: "Segoe UI", "Meiryo", sans-serif;
        background-color: #f5f9ff;
        color: #333;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
      }
      h1 {
        color: #2c3e50;
        text-align: center;
        margin-bottom: 30px;
        font-size: 32px;
      }
      .diagram-container {
        display: flex;
        justify-content: center;
      }
      .diagram {
        width: 100%;
        max-width: 800px;
      }
      .box {
        margin-bottom: 60px;
        position: relative;
      }
      .arrow-container {
        height: 40px;
        position: relative;
        margin-bottom: 20px;
      }
      .arrow {
        position: absolute;
        left: 50%;
        top: 0;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 20px solid transparent;
        border-right: 20px solid transparent;
        border-top: 25px solid #1976d2;
      }
      .arrow-line {
        position: absolute;
        left: 50%;
        top: -15px;
        transform: translateX(-50%);
        width: 3px;
        height: 15px;
        background-color: #1976d2;
      }
      .arrow-label {
        position: absolute;
        right: 0;
        top: 5px;
        color: #1976d2;
        font-size: 14px;
        padding: 5px 10px;
        background-color: #e3f2fd;
        border-radius: 4px;
        border: 1px solid #bbdefb;
        width: 130px;
        text-align: center;
      }
      .content-box {
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      .state-box {
        background-color: #e3f2fd;
        border: 2px solid #2196f3;
      }
      .selector-box {
        background-color: #bbdefb;
        border: 2px solid #1976d2;
      }
      .result-box {
        background-color: #e1f5fe;
        border: 2px solid #03a9f4;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background-color: rgba(255, 255, 255, 0.3);
      }
      .header-title {
        font-weight: bold;
        color: #0d47a1;
        font-size: 18px;
      }
      .header-badge {
        background-color: #1976d2;
        color: white;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: bold;
      }
      .content {
        padding: 15px;
        background-color: rgba(255, 255, 255, 0.7);
        font-family: monospace;
        font-size: 14px;
        overflow-x: auto;
      }

      /* コードの色付けと整形 */
      pre {
        margin: 0;
        white-space: pre;
        tab-size: 2;
      }
      .keyword {
        color: #0033b3;
        font-weight: bold;
      }
      .function {
        color: #7d5bbf;
      }
      .string {
        color: #008000;
      }
      .number {
        color: #1750eb;
      }
      .boolean {
        color: #0033b3;
        font-weight: bold;
      }
      .comment {
        color: #808080;
        font-style: italic;
      }
      .property {
        color: #871094;
      }
      .operator {
        color: #5c5c5c;
      }
      .bracket {
        color: #333;
      }
      .parameter {
        color: #b76f01;
      }

      .explanation-diagram {
        margin: 15px 0 30px;
        padding: 20px;
        background-color: #f0f9ff;
        border-radius: 10px;
        border: 2px solid #2196f3;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .input-selector-diagram {
        width: 100%;
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .diagram-item {
        text-align: center;
        flex: 1;
        max-width: 200px;
        margin: 0 10px;
      }

      .diagram-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 15px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #e3f2fd;
        border-radius: 50%;
        border: 2px solid #1976d2;
        font-size: 40px;
        color: #1976d2;
      }

      .diagram-title {
        font-weight: bold;
        color: #0d47a1;
        margin-bottom: 10px;
        font-size: 16px;
      }

      .diagram-desc {
        color: #0d47a1;
        font-size: 14px;
        line-height: 1.4;
      }

      .diagram-arrow {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 -10px;
      }

      .diagram-arrow svg {
        width: 50px;
        height: 30px;
        fill: #1976d2;
      }

      .center-flow {
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 15px 0;
      }

      .flow-arrow {
        width: 60%;
        height: 60px;
        position: relative;
      }

      .flow-arrow-line {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 3px;
        background-color: #1976d2;
      }

      .flow-arrow-head {
        position: absolute;
        right: -10px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        border-left: 15px solid #1976d2;
      }

      .flow-label {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        text-align: center;
        color: #1976d2;
        font-weight: bold;
        font-size: 14px;
      }

      .memoization-box {
        margin-top: 20px;
        margin-bottom: 30px;
        border: 2px dashed #5c6bc0;
        border-radius: 8px;
        padding: 15px;
        background-color: #e8eaf6;
      }
      .memoization-title {
        color: #3f51b5;
        font-weight: bold;
        margin-bottom: 15px;
        font-size: 18px;
        text-align: center;
      }
      .memoization-content {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .memo-item {
        background-color: white;
        border-radius: 6px;
        padding: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .memo-header {
        font-weight: bold;
        color: #3f51b5;
        margin-bottom: 5px;
      }

      .benefits {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-top: 20px;
      }
      .benefit {
        background-color: #e3f2fd;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
      }
      .benefit-icon {
        font-size: 28px;
        color: #1976d2;
        margin-right: 15px;
      }
      .benefit-content {
        flex: 1;
      }
      .benefit-title {
        font-weight: bold;
        color: #0d47a1;
        margin-bottom: 5px;
      }
      .benefit-desc {
        font-size: 14px;
        line-height: 1.4;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>NgRx セレクターの仕組み</h1>

      <div class="diagram-container">
        <div class="diagram">
          <!-- 状態 -->
          <div class="box">
            <div class="content-box state-box">
              <div class="header">
                <div class="header-title">アプリケーションの状態 (State)</div>
              </div>
              <div class="content">
                <pre><span class="bracket">{</span>
  <span class="property">users</span><span class="operator">:</span> <span class="bracket">[</span>
    <span class="bracket">{</span>
      <span class="property">id</span><span class="operator">:</span> <span class="number">1</span>,
      <span class="property">name</span><span class="operator">:</span> <span class="string">"田中"</span>,
      <span class="property">age</span><span class="operator">:</span> <span class="number">28</span>,
      <span class="property">active</span><span class="operator">:</span> <span class="boolean">true</span>
    <span class="bracket">}</span>,
    <span class="bracket">{</span>
      <span class="property">id</span><span class="operator">:</span> <span class="number">2</span>,
      <span class="property">name</span><span class="operator">:</span> <span class="string">"鈴木"</span>,
      <span class="property">age</span><span class="operator">:</span> <span class="number">34</span>,
      <span class="property">active</span><span class="operator">:</span> <span class="boolean">false</span>
    <span class="bracket">}</span>,
    <span class="bracket">{</span>
      <span class="property">id</span><span class="operator">:</span> <span class="number">3</span>,
      <span class="property">name</span><span class="operator">:</span> <span class="string">"佐藤"</span>,
      <span class="property">age</span><span class="operator">:</span> <span class="number">22</span>,
      <span class="property">active</span><span class="operator">:</span> <span class="boolean">true</span>
    <span class="bracket">}</span>,
    <span class="bracket">{</span>
      <span class="property">id</span><span class="operator">:</span> <span class="number">4</span>,
      <span class="property">name</span><span class="operator">:</span> <span class="string">"高橋"</span>,
      <span class="property">age</span><span class="operator">:</span> <span class="number">41</span>,
      <span class="property">active</span><span class="operator">:</span> <span class="boolean">true</span>
    <span class="bracket">}</span>,
    <span class="bracket">{</span>
      <span class="property">id</span><span class="operator">:</span> <span class="number">5</span>,
      <span class="property">name</span><span class="operator">:</span> <span class="string">"伊藤"</span>,
      <span class="property">age</span><span class="operator">:</span> <span class="number">19</span>,
      <span class="property">active</span><span class="operator">:</span> <span class="boolean">false</span>
    <span class="bracket">}</span>
  <span class="bracket">]</span>,
  <span class="property">filters</span><span class="operator">:</span> <span class="bracket">{</span>
    <span class="property">minAge</span><span class="operator">:</span> <span class="number">20</span>,
    <span class="property">onlyActive</span><span class="operator">:</span> <span class="boolean">true</span>
  <span class="bracket">}</span>
<span class="bracket">}</span></pre>
              </div>
            </div>
          </div>

          <div class="arrow-container">
            <div class="arrow-line"></div>
            <div class="arrow"></div>
            <div class="arrow-label">状態から特定のデータを取得</div>
          </div>

          <!-- 入力セレクター -->
          <div class="box">
            <div class="content-box selector-box">
              <div class="header">
                <div class="header-title">入力セレクター</div>
                <div class="header-badge">基本セレクター</div>
              </div>
              <div class="content">
                <pre><span class="keyword">const</span> <span class="function">getUsers</span> <span class="operator">=</span> (<span class="parameter">state</span>) <span class="operator">=></span> state.users;
<span class="keyword">const</span> <span class="function">getFilters</span> <span class="operator">=</span> (<span class="parameter">state</span>) <span class="operator">=></span> state.filters;</pre>
              </div>
            </div>
          </div>

          <!-- 入力セレクターの役割（図式化） -->
          <div class="explanation-diagram">
            <h3 style="color: #0d47a1; margin-top: 0">入力セレクターの役割</h3>

            <div class="input-selector-diagram">
              <div class="diagram-item">
                <div class="diagram-icon">🔍</div>
                <div class="diagram-title">状態の特定部分を抽出</div>
                <div class="diagram-desc">
                  複雑な状態から必要な部分だけをピンポイントで取得
                </div>
              </div>

              <div class="diagram-arrow">
                <svg viewBox="0 0 24 24">
                  <path d="M5 12h14M12 5l7 7-7 7"></path>
                </svg>
              </div>

              <div class="diagram-item">
                <div class="diagram-icon">🧩</div>
                <div class="diagram-title">構造の隠蔽</div>
                <div class="diagram-desc">
                  状態の内部構造をUIコンポーネントから隠す
                </div>
              </div>

              <div class="diagram-arrow">
                <svg viewBox="0 0 24 24">
                  <path d="M5 12h14M12 5l7 7-7 7"></path>
                </svg>
              </div>

              <div class="diagram-item">
                <div class="diagram-icon">🧱</div>
                <div class="diagram-title">複合セレクターの基礎</div>
                <div class="diagram-desc">より複雑なデータ変換の土台となる</div>
              </div>
            </div>

            <div class="center-flow">
              <div class="flow-arrow">
                <div class="flow-arrow-line"></div>
                <div class="flow-arrow-head"></div>
                <div class="flow-label">データフロー</div>
              </div>
            </div>

            <div class="input-selector-diagram">
              <div class="diagram-item">
                <div class="diagram-icon">⚡</div>
                <div class="diagram-title">単純な関数</div>
                <div class="diagram-desc">
                  複雑な計算や変換を行わない純粋な関数
                </div>
              </div>

              <div class="diagram-arrow">
                <svg viewBox="0 0 24 24">
                  <path d="M5 12h14M12 5l7 7-7 7"></path>
                </svg>
              </div>

              <div class="diagram-item">
                <div class="diagram-icon">🛡️</div>
                <div class="diagram-title">柔軟性の向上</div>
                <div class="diagram-desc">
                  状態構造が変更されても影響を最小限に抑える
                </div>
              </div>

              <div class="diagram-arrow">
                <svg viewBox="0 0 24 24">
                  <path d="M5 12h14M12 5l7 7-7 7"></path>
                </svg>
              </div>

              <div class="diagram-item">
                <div class="diagram-icon">📦</div>
                <div class="diagram-title">再利用性</div>
                <div class="diagram-desc">
                  複数の場所で同じセレクターを再利用可能
                </div>
              </div>
            </div>
          </div>

          <div class="arrow-container">
            <div class="arrow-line"></div>
            <div class="arrow"></div>
            <div class="arrow-label">複数のセレクターの入力を組み合わせる</div>
          </div>

          <!-- 複合セレクター -->
          <div class="box">
            <div class="content-box selector-box">
              <div class="header">
                <div class="header-title">複合セレクター（メモ化あり）</div>
                <div class="header-badge">createSelector</div>
              </div>
              <div class="content">
                <pre><span class="keyword">const</span> <span class="function">getFilteredUsers</span> <span class="operator">=</span> <span class="function">createSelector</span>(
  [<span class="function">getUsers</span>, <span class="function">getFilters</span>], <span class="comment">// 入力セレクター</span>
  (<span class="parameter">users</span>, <span class="parameter">filters</span>) <span class="operator">=></span> { <span class="comment">// 結果関数（プロジェクター）</span>
    <span class="keyword">return</span> users.<span class="function">filter</span>((user) <span class="operator">=></span> {
      <span class="comment">// 年齢フィルター</span>
      <span class="keyword">if</span> (user.age < filters.minAge) <span class="keyword">return</span> <span class="boolean">false</span>;
      
      <span class="comment">// アクティブユーザーフィルター</span>
      <span class="keyword">if</span> (filters.onlyActive && !user.active) <span class="keyword">return</span> <span class="boolean">false</span>;
      
      <span class="keyword">return</span> <span class="boolean">true</span>;
    });
  }
);</pre>
              </div>
            </div>
          </div>

          <!-- 複合セレクターの図式化 -->
          <div class="explanation-diagram">
            <h3 style="color: #0d47a1; margin-top: 0">
              複合セレクターの仕組み
            </h3>

            <!-- 上部のプロセスフロー -->
            <div
              class="process-flow"
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
                position: relative;
              "
            >
              <!-- 入力セレクター1 -->
              <div
                style="
                  text-align: center;
                  background-color: #bbdefb;
                  border: 2px solid #1976d2;
                  border-radius: 8px;
                  padding: 10px;
                  width: 120px;
                "
              >
                <div
                  style="font-weight: bold; color: #0d47a1; margin-bottom: 5px"
                >
                  getUsers
                </div>
                <div style="font-size: 12px; color: #1976d2">
                  ユーザー配列を取得
                </div>
              </div>

              <!-- 矢印 -->
              <div
                style="
                  flex: 1;
                  position: relative;
                  height: 40px;
                  margin: 0 15px;
                "
              >
                <div
                  style="
                    position: absolute;
                    left: 0;
                    right: 0;
                    top: 50%;
                    height: 2px;
                    background-color: #1976d2;
                  "
                ></div>
                <div
                  style="
                    position: absolute;
                    right: -5px;
                    top: 50%;
                    transform: translateY(-50%);
                    width: 0;
                    height: 0;
                    border-top: 6px solid transparent;
                    border-bottom: 6px solid transparent;
                    border-left: 10px solid #1976d2;
                  "
                ></div>
              </div>

              <!-- createSelector -->
              <div
                style="
                  text-align: center;
                  background-color: #e1f5fe;
                  border: 2px solid #03a9f4;
                  border-radius: 8px;
                  padding: 10px;
                  width: 150px;
                  position: relative;
                "
              >
                <div
                  style="font-weight: bold; color: #0d47a1; margin-bottom: 5px"
                >
                  createSelector
                </div>
                <div style="font-size: 12px; color: #1976d2">
                  入力を組み合わせて計算
                </div>
                <div
                  style="
                    position: absolute;
                    right: -12px;
                    top: -12px;
                    background-color: #1976d2;
                    color: white;
                    border-radius: 50%;
                    width: 24px;
                    height: 24px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    font-size: 14px;
                    font-weight: bold;
                  "
                >
                  +
                </div>
              </div>

              <!-- 矢印 -->
              <div
                style="
                  flex: 1;
                  position: relative;
                  height: 40px;
                  margin: 0 15px;
                "
              >
                <div
                  style="
                    position: absolute;
                    left: 0;
                    right: 0;
                    top: 50%;
                    height: 2px;
                    background-color: #1976d2;
                  "
                ></div>
                <div
                  style="
                    position: absolute;
                    right: -5px;
                    top: 50%;
                    transform: translateY(-50%);
                    width: 0;
                    height: 0;
                    border-top: 6px solid transparent;
                    border-bottom: 6px solid transparent;
                    border-left: 10px solid #1976d2;
                  "
                ></div>
              </div>

              <!-- 入力セレクター2 -->
              <div
                style="
                  text-align: center;
                  background-color: #bbdefb;
                  border: 2px solid #1976d2;
                  border-radius: 8px;
                  padding: 10px;
                  width: 120px;
                "
              >
                <div
                  style="font-weight: bold; color: #0d47a1; margin-bottom: 5px"
                >
                  getFilters
                </div>
                <div style="font-size: 12px; color: #1976d2">
                  フィルター条件を取得
                </div>
              </div>
            </div>

            <!-- プロジェクション関数 -->
            <div
              style="
                background-color: #e8f5e9;
                border: 2px solid #4caf50;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 25px;
              "
            >
              <div
                style="display: flex; align-items: center; margin-bottom: 10px"
              >
                <div
                  style="
                    background-color: #4caf50;
                    color: white;
                    border-radius: 50%;
                    width: 30px;
                    height: 30px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    margin-right: 10px;
                    font-weight: bold;
                  "
                >
                  fn
                </div>
                <div style="font-weight: bold; color: #1b5e20; font-size: 16px">
                  プロジェクション関数（セレクターの計算部分）
                </div>
              </div>
              <div style="font-size: 14px; color: #2e7d32; margin-bottom: 15px">
                入力セレクターの結果を受け取り、新しい派生データを計算する関数
              </div>

              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  margin-top: 10px;
                "
              >
                <div style="text-align: center; flex: 1">
                  <div
                    style="
                      font-weight: bold;
                      color: #1b5e20;
                      margin-bottom: 5px;
                    "
                  >
                    入力
                  </div>
                  <div
                    style="
                      background-color: white;
                      border-radius: 5px;
                      padding: 8px;
                      font-size: 12px;
                      font-family: monospace;
                    "
                  >
                    users, filters
                  </div>
                </div>
                <div style="text-align: center; flex: 1">
                  <div
                    style="
                      font-weight: bold;
                      color: #1b5e20;
                      margin-bottom: 5px;
                    "
                  >
                    処理
                  </div>
                  <div
                    style="
                      background-color: white;
                      border-radius: 5px;
                      padding: 8px;
                      font-size: 12px;
                      font-family: monospace;
                    "
                  >
                    filter()による絞り込み
                  </div>
                </div>
                <div style="text-align: center; flex: 1">
                  <div
                    style="
                      font-weight: bold;
                      color: #1b5e20;
                      margin-bottom: 5px;
                    "
                  >
                    出力
                  </div>
                  <div
                    style="
                      background-color: white;
                      border-radius: 5px;
                      padding: 8px;
                      font-size: 12px;
                      font-family: monospace;
                    "
                  >
                    フィルター済みユーザー配列
                  </div>
                </div>
              </div>
            </div>

            <!-- メモ化の仕組み -->
            <div
              style="
                background-color: #fff8e1;
                border: 2px dashed #ffa000;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 25px;
              "
            >
              <div
                style="
                  font-weight: bold;
                  color: #ff6f00;
                  font-size: 16px;
                  margin-bottom: 15px;
                  text-align: center;
                "
              >
                メモ化の仕組み
              </div>

              <div style="display: flex; align-items: stretch; gap: 15px">
                <div
                  style="
                    flex: 1;
                    background-color: white;
                    border-radius: 8px;
                    padding: 12px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                  "
                >
                  <div
                    style="
                      display: flex;
                      align-items: center;
                      margin-bottom: 10px;
                    "
                  >
                    <div
                      style="
                        background-color: #ffa000;
                        color: white;
                        border-radius: 50%;
                        width: 24px;
                        height: 24px;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        margin-right: 10px;
                      "
                    >
                      1
                    </div>
                    <div style="font-weight: bold; color: #ff6f00">
                      入力値をキーとして使用
                    </div>
                  </div>
                  <div
                    style="font-size: 13px; color: #ff8f00; line-height: 1.4"
                  >
                    入力セレクターから受け取った値のリファレンスをキーとしてキャッシュに保存
                  </div>
                </div>

                <div
                  style="
                    flex: 1;
                    background-color: white;
                    border-radius: 8px;
                    padding: 12px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                  "
                >
                  <div
                    style="
                      display: flex;
                      align-items: center;
                      margin-bottom: 10px;
                    "
                  >
                    <div
                      style="
                        background-color: #ffa000;
                        color: white;
                        border-radius: 50%;
                        width: 24px;
                        height: 24px;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        margin-right: 10px;
                      "
                    >
                      2
                    </div>
                    <div style="font-weight: bold; color: #ff6f00">
                      入力比較で再計算判断
                    </div>
                  </div>
                  <div
                    style="font-size: 13px; color: #ff8f00; line-height: 1.4"
                  >
                    前回と同じ入力値（参照が同一）なら、計算済みの結果を再利用
                  </div>
                </div>

                <div
                  style="
                    flex: 1;
                    background-color: white;
                    border-radius: 8px;
                    padding: 12px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                  "
                >
                  <div
                    style="
                      display: flex;
                      align-items: center;
                      margin-bottom: 10px;
                    "
                  >
                    <div
                      style="
                        background-color: #ffa000;
                        color: white;
                        border-radius: 50%;
                        width: 24px;
                        height: 24px;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        margin-right: 10px;
                      "
                    >
                      3
                    </div>
                    <div style="font-weight: bold; color: #ff6f00">
                      パフォーマンス最適化
                    </div>
                  </div>
                  <div
                    style="font-size: 13px; color: #ff8f00; line-height: 1.4"
                  >
                    不要な再計算を防ぎ、アプリケーションの応答性を向上させる
                  </div>
                </div>
              </div>
            </div>

            <!-- 複合セレクターの利点 -->
            <div
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px"
            >
              <div
                style="
                  background-color: #e3f2fd;
                  border-radius: 8px;
                  padding: 12px;
                  display: flex;
                  align-items: flex-start;
                "
              >
                <div
                  style="font-size: 24px; color: #1976d2; margin-right: 10px"
                >
                  📊
                </div>
                <div>
                  <div
                    style="
                      font-weight: bold;
                      color: #0d47a1;
                      margin-bottom: 5px;
                    "
                  >
                    派生データの計算
                  </div>
                  <div
                    style="font-size: 13px; color: #1565c0; line-height: 1.4"
                  >
                    複数のデータソースから新しい値を計算し、UIに必要な形に変換
                  </div>
                </div>
              </div>

              <div
                style="
                  background-color: #e3f2fd;
                  border-radius: 8px;
                  padding: 12px;
                  display: flex;
                  align-items: flex-start;
                "
              >
                <div
                  style="font-size: 24px; color: #1976d2; margin-right: 10px"
                >
                  ⚡
                </div>
                <div>
                  <div
                    style="
                      font-weight: bold;
                      color: #0d47a1;
                      margin-bottom: 5px;
                    "
                  >
                    自動メモ化
                  </div>
                  <div
                    style="font-size: 13px; color: #1565c0; line-height: 1.4"
                  >
                    createSelectorが内部的にメモ化を処理し、手動実装が不要
                  </div>
                </div>
              </div>

              <div
                style="
                  background-color: #e3f2fd;
                  border-radius: 8px;
                  padding: 12px;
                  display: flex;
                  align-items: flex-start;
                "
              >
                <div
                  style="font-size: 24px; color: #1976d2; margin-right: 10px"
                >
                  🔄
                </div>
                <div>
                  <div
                    style="
                      font-weight: bold;
                      color: #0d47a1;
                      margin-bottom: 5px;
                    "
                  >
                    再利用可能な構成
                  </div>
                  <div
                    style="font-size: 13px; color: #1565c0; line-height: 1.4"
                  >
                    他のセレクターの入力として使用でき、複雑なデータ変換を構築可能
                  </div>
                </div>
              </div>

              <div
                style="
                  background-color: #e3f2fd;
                  border-radius: 8px;
                  padding: 12px;
                  display: flex;
                  align-items: flex-start;
                "
              >
                <div
                  style="font-size: 24px; color: #1976d2; margin-right: 10px"
                >
                  🧩
                </div>
                <div>
                  <div
                    style="
                      font-weight: bold;
                      color: #0d47a1;
                      margin-bottom: 5px;
                    "
                  >
                    宣言的なデータフロー
                  </div>
                  <div
                    style="font-size: 13px; color: #1565c0; line-height: 1.4"
                  >
                    データの変換と計算を明示的に定義し、予測可能な状態管理を実現
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="arrow-container">
            <div class="arrow-line"></div>
            <div class="arrow"></div>
            <div class="arrow-label">既存のセレクターを入力として使用</div>
          </div>

          <!-- セレクターの合成 -->
          <div class="box">
            <div class="content-box selector-box">
              <div class="header">
                <div class="header-title">セレクターの合成</div>
                <div class="header-badge">createSelector</div>
              </div>
              <div class="content">
                <pre><span class="keyword">const</span> <span class="function">getActiveUserCount</span> <span class="operator">=</span> <span class="function">createSelector</span>(
  [<span class="function">getFilteredUsers</span>], <span class="comment">// 既存の複合セレクターを入力として使用</span>
  (<span class="parameter">filteredUsers</span>) <span class="operator">=></span> { <span class="comment">// 結果関数（プロジェクター）</span>
    <span class="keyword">return</span> filteredUsers.length;
  }
);</pre>
              </div>
            </div>
          </div>

          <!-- セレクターの合成の図式化 -->
          <div class="explanation-diagram">
            <h3 style="color: #0d47a1; margin-top: 0">
              セレクターの合成の仕組み
            </h3>

            <!-- セレクター合成の階層図 -->
            <div
              style="
                position: relative;
                margin: 20px 0 40px;
                display: flex;
                flex-direction: column;
                align-items: center;
              "
            >
              <!-- 第3階層：最終結果 -->
              <div
                style="
                  background-color: #e1f5fe;
                  border: 2px solid #03a9f4;
                  border-radius: 10px;
                  padding: 15px;
                  width: 280px;
                  text-align: center;
                  margin-bottom: 30px;
                  position: relative;
                  z-index: 3;
                "
              >
                <div
                  style="
                    font-weight: bold;
                    color: #01579b;
                    font-size: 16px;
                    margin-bottom: 8px;
                  "
                >
                  getActiveUserCount
                </div>
                <div style="font-size: 13px; color: #0288d1">
                  フィルター済みユーザーの数を計算
                </div>
                <div
                  style="
                    margin-top: 10px;
                    background-color: white;
                    border-radius: 6px;
                    padding: 8px;
                    font-family: monospace;
                    font-size: 12px;
                    color: #333;
                    text-align: left;
                  "
                >
                  return filteredUsers.length;
                </div>

                <!-- 結果バッジ -->
                <div
                  style="
                    position: absolute;
                    right: -10px;
                    top: -10px;
                    background-color: #00bcd4;
                    color: white;
                    border-radius: 20px;
                    padding: 5px 10px;
                    font-size: 12px;
                    font-weight: bold;
                  "
                >
                  結果: 数値
                </div>
              </div>

              <!-- 接続線 -->
              <div
                style="
                  position: absolute;
                  width: 3px;
                  height: 30px;
                  background-color: #03a9f4;
                  top: 50px;
                  z-index: 1;
                "
              ></div>
              <div
                style="
                  position: absolute;
                  width: 0;
                  height: 0;
                  border-left: 10px solid transparent;
                  border-right: 10px solid transparent;
                  border-top: 15px solid #03a9f4;
                  top: 80px;
                  z-index: 1;
                "
              ></div>

              <!-- 第2階層：フィルタリング -->
              <div
                style="
                  background-color: #bbdefb;
                  border: 2px solid #1976d2;
                  border-radius: 10px;
                  padding: 15px;
                  width: 350px;
                  text-align: center;
                  margin-bottom: 30px;
                  position: relative;
                  z-index: 2;
                "
              >
                <div
                  style="
                    font-weight: bold;
                    color: #0d47a1;
                    font-size: 16px;
                    margin-bottom: 8px;
                  "
                >
                  getFilteredUsers
                </div>
                <div style="font-size: 13px; color: #1565c0">
                  条件に合致するユーザーをフィルタリング
                </div>
                <div
                  style="
                    margin-top: 10px;
                    background-color: white;
                    border-radius: 6px;
                    padding: 8px;
                    font-family: monospace;
                    font-size: 12px;
                    color: #333;
                    text-align: left;
                  "
                >
                  return users.filter(user => ...);
                </div>

                <!-- 結果バッジ -->
                <div
                  style="
                    position: absolute;
                    right: -10px;
                    top: -10px;
                    background-color: #2196f3;
                    color: white;
                    border-radius: 20px;
                    padding: 5px 10px;
                    font-size: 12px;
                    font-weight: bold;
                  "
                >
                  結果: 配列
                </div>
              </div>

              <!-- 接続線 -->
              <div
                style="
                  position: absolute;
                  width: 3px;
                  height: 30px;
                  background-color: #1976d2;
                  top: 150px;
                  z-index: 1;
                "
              ></div>
              <div
                style="
                  position: absolute;
                  width: 0;
                  height: 0;
                  border-left: 10px solid transparent;
                  border-right: 10px solid transparent;
                  border-top: 15px solid #1976d2;
                  top: 180px;
                  z-index: 1;
                "
              ></div>

              <!-- 第1階層：元データ -->
              <div style="display: flex; gap: 20px; z-index: 1">
                <div
                  style="
                    background-color: #e3f2fd;
                    border: 2px solid #2196f3;
                    border-radius: 10px;
                    padding: 15px;
                    width: 180px;
                    text-align: center;
                  "
                >
                  <div
                    style="
                      font-weight: bold;
                      color: #0d47a1;
                      font-size: 16px;
                      margin-bottom: 8px;
                    "
                  >
                    getUsers
                  </div>
                  <div style="font-size: 13px; color: #1976d2">
                    全ユーザー配列
                  </div>
                </div>

                <div
                  style="
                    background-color: #e3f2fd;
                    border: 2px solid #2196f3;
                    border-radius: 10px;
                    padding: 15px;
                    width: 180px;
                    text-align: center;
                  "
                >
                  <div
                    style="
                      font-weight: bold;
                      color: #0d47a1;
                      font-size: 16px;
                      margin-bottom: 8px;
                    "
                  >
                    getFilters
                  </div>
                  <div style="font-size: 13px; color: #1976d2">
                    フィルター条件
                  </div>
                </div>
              </div>
            </div>

            <!-- セレクター合成の主な特徴 -->
            <div
              style="
                margin: 20px 0;
                padding: 15px;
                background-color: #ede7f6;
                border-radius: 10px;
                border-left: 5px solid #673ab7;
              "
            >
              <div
                style="
                  font-weight: bold;
                  color: #4527a0;
                  font-size: 16px;
                  margin-bottom: 15px;
                "
              >
                セレクター合成の特徴
              </div>

              <div
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px"
              >
                <div
                  style="
                    display: flex;
                    align-items: flex-start;
                    background-color: white;
                    border-radius: 8px;
                    padding: 12px;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                  "
                >
                  <div
                    style="
                      background-color: #673ab7;
                      color: white;
                      border-radius: 50%;
                      width: 28px;
                      height: 28px;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      margin-right: 10px;
                      font-size: 16px;
                    "
                  >
                    🔄
                  </div>
                  <div>
                    <div
                      style="
                        font-weight: bold;
                        color: #4527a0;
                        margin-bottom: 5px;
                      "
                    >
                      階層的な変換
                    </div>
                    <div
                      style="font-size: 13px; color: #5e35b1; line-height: 1.4"
                    >
                      複雑な変換を小さなステップに分割し、段階的に処理
                    </div>
                  </div>
                </div>

                <div
                  style="
                    display: flex;
                    align-items: flex-start;
                    background-color: white;
                    border-radius: 8px;
                    padding: 12px;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                  "
                >
                  <div
                    style="
                      background-color: #673ab7;
                      color: white;
                      border-radius: 50%;
                      width: 28px;
                      height: 28px;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      margin-right: 10px;
                      font-size: 16px;
                    "
                  >
                    ⚙️
                  </div>
                  <div>
                    <div
                      style="
                        font-weight: bold;
                        color: #4527a0;
                        margin-bottom: 5px;
                      "
                    >
                      再利用性
                    </div>
                    <div
                      style="font-size: 13px; color: #5e35b1; line-height: 1.4"
                    >
                      中間セレクターを様々な計算に再利用可能
                    </div>
                  </div>
                </div>

                <div
                  style="
                    display: flex;
                    align-items: flex-start;
                    background-color: white;
                    border-radius: 8px;
                    padding: 12px;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                  "
                >
                  <div
                    style="
                      background-color: #673ab7;
                      color: white;
                      border-radius: 50%;
                      width: 28px;
                      height: 28px;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      margin-right: 10px;
                      font-size: 16px;
                    "
                  >
                    🚀
                  </div>
                  <div>
                    <div
                      style="
                        font-weight: bold;
                        color: #4527a0;
                        margin-bottom: 5px;
                      "
                    >
                      メモ化の連鎖
                    </div>
                    <div
                      style="font-size: 13px; color: #5e35b1; line-height: 1.4"
                    >
                      各階層でメモ化が適用され、変更がない部分は再計算を回避
                    </div>
                  </div>
                </div>

                <div
                  style="
                    display: flex;
                    align-items: flex-start;
                    background-color: white;
                    border-radius: 8px;
                    padding: 12px;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                  "
                >
                  <div
                    style="
                      background-color: #673ab7;
                      color: white;
                      border-radius: 50%;
                      width: 28px;
                      height: 28px;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      margin-right: 10px;
                      font-size: 16px;
                    "
                  >
                    📊
                  </div>
                  <div>
                    <div
                      style="
                        font-weight: bold;
                        color: #4527a0;
                        margin-bottom: 5px;
                      "
                    >
                      データ変換パイプライン
                    </div>
                    <div
                      style="font-size: 13px; color: #5e35b1; line-height: 1.4"
                    >
                      複数のセレクターが連携してデータ変換パイプラインを構築
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 実際の例 -->
            <div
              style="
                background-color: #fafafa;
                border: 1px solid #e0e0e0;
                border-radius: 10px;
                padding: 15px;
                margin-top: 20px;
              "
            >
              <div
                style="
                  font-weight: bold;
                  color: #424242;
                  font-size: 16px;
                  margin-bottom: 15px;
                  text-align: center;
                "
              >
                セレクター合成の例
              </div>

              <div
                style="
                  display: flex;
                  align-items: center;
                  justify-content: space-between;
                  margin-bottom: 20px;
                "
              >
                <div
                  style="
                    flex: 1;
                    text-align: center;
                    padding: 10px;
                    font-size: 13px;
                    color: #616161;
                  "
                >
                  <div style="font-weight: bold; margin-bottom: 5px">
                    元の状態
                  </div>
                  <div
                    style="
                      font-family: monospace;
                      background-color: #f5f5f5;
                      padding: 8px;
                      border-radius: 4px;
                      text-align: left;
                      font-size: 12px;
                    "
                  >
                    users: [...]<br />
                    filters: { minAge: 20, onlyActive: true }
                  </div>
                </div>

                <div style="width: 30px; text-align: center">→</div>

                <div
                  style="
                    flex: 1;
                    text-align: center;
                    padding: 10px;
                    font-size: 13px;
                    color: #616161;
                  "
                >
                  <div style="font-weight: bold; margin-bottom: 5px">
                    フィルター適用
                  </div>
                  <div
                    style="
                      font-family: monospace;
                      background-color: #f5f5f5;
                      padding: 8px;
                      border-radius: 4px;
                      text-align: left;
                      font-size: 12px;
                    "
                  >
                    [<br />
                    &nbsp;&nbsp;{ id: 1, name: "田中", ... },<br />
                    &nbsp;&nbsp;{ id: 3, name: "佐藤", ... },<br />
                    &nbsp;&nbsp;{ id: 4, name: "高橋", ... }<br />
                    ]
                  </div>
                </div>

                <div style="width: 30px; text-align: center">→</div>

                <div
                  style="
                    flex: 1;
                    text-align: center;
                    padding: 10px;
                    font-size: 13px;
                    color: #616161;
                  "
                >
                  <div style="font-weight: bold; margin-bottom: 5px">
                    最終結果
                  </div>
                  <div
                    style="
                      font-family: monospace;
                      background-color: #f5f5f5;
                      padding: 8px;
                      border-radius: 4px;
                      font-size: 12px;
                    "
                  >
                    3
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="arrow-container">
            <div class="arrow-line"></div>
            <div class="arrow"></div>
            <div class="arrow-label">計算結果</div>
          </div>

          <!-- 結果 -->
          <div class="box">
            <div class="content-box result-box">
              <div class="header">
                <div class="header-title">結果</div>
              </div>
              <div class="content">
                <pre><span class="bracket">[</span>
  <span class="bracket">{</span>
    <span class="property">id</span><span class="operator">:</span> <span class="number">1</span>,
    <span class="property">name</span><span class="operator">:</span> <span class="string">"田中"</span>,
    <span class="property">age</span><span class="operator">:</span> <span class="number">28</span>,
    <span class="property">active</span><span class="operator">:</span> <span class="boolean">true</span>
  <span class="bracket">}</span>,
  <span class="bracket">{</span>
    <span class="property">id</span><span class="operator">:</span> <span class="number">3</span>,
    <span class="property">name</span><span class="operator">:</span> <span class="string">"佐藤"</span>,
    <span class="property">age</span><span class="operator">:</span> <span class="number">22</span>,
    <span class="property">active</span><span class="operator">:</span> <span class="boolean">true</span>
  <span class="bracket">}</span>,
  <span class="bracket">{</span>
    <span class="property">id</span><span class="operator">:</span> <span class="number">4</span>,
    <span class="property">name</span><span class="operator">:</span> <span class="string">"高橋"</span>,
    <span class="property">age</span><span class="operator">:</span> <span class="number">41</span>,
    <span class="property">active</span><span class="operator">:</span> <span class="boolean">true</span>
  <span class="bracket">}</span>
<span class="bracket">]</span>

<span class="property">アクティブユーザー数</span><span class="operator">:</span> <span class="number">3</span></pre>
              </div>
            </div>
          </div>

          <!-- メモ化キャッシュ -->
          <div class="memoization-box">
            <div class="memoization-title">メモ化キャッシュの仕組み</div>
            <div class="memoization-content">
              <div class="memo-item">
                <div class="memo-header">getFilteredUsers のキャッシュ:</div>
                <div class="content">
                  <pre><span class="property">入力値</span><span class="operator">:</span> [
  [
    <span class="bracket">{</span> <span class="property">id</span><span class="operator">:</span> <span class="number">1</span>, <span class="comment">/* ユーザー配列 */</span> <span class="bracket">}</span>,
    ...
  ],
  <span class="bracket">{</span> 
    <span class="property">minAge</span><span class="operator">:</span> <span class="number">20</span>, 
    <span class="property">onlyActive</span><span class="operator">:</span> <span class="boolean">true</span> 
  <span class="bracket">}</span>
]

<span class="property">キャッシュ結果</span><span class="operator">:</span> [
  <span class="bracket">{</span> 
    <span class="property">id</span><span class="operator">:</span> <span class="number">1</span>,
    <span class="property">name</span><span class="operator">:</span> <span class="string">"田中"</span>,
    ... 
  <span class="bracket">}</span>,
  <span class="bracket">{</span> 
    <span class="property">id</span><span class="operator">:</span> <span class="number">3</span>,
    <span class="property">name</span><span class="operator">:</span> <span class="string">"佐藤"</span>,
    ... 
  <span class="bracket">}</span>,
  <span class="bracket">{</span> 
    <span class="property">id</span><span class="operator">:</span> <span class="number">4</span>,
    <span class="property">name</span><span class="operator">:</span> <span class="string">"高橋"</span>,
    ... 
  <span class="bracket">}</span>
]</pre>
                </div>
              </div>
              <div class="memo-item">
                <div class="memo-header">getActiveUserCount のキャッシュ:</div>
                <div class="content">
                  <pre><span class="property">入力値</span><span class="operator">:</span> [
  [
    <span class="bracket">{</span> <span class="property">id</span><span class="operator">:</span> <span class="number">1</span>, ... <span class="bracket">}</span>,
    <span class="bracket">{</span> <span class="property">id</span><span class="operator">:</span> <span class="number">3</span>, ... <span class="bracket">}</span>,
    <span class="bracket">{</span> <span class="property">id</span><span class="operator">:</span> <span class="number">4</span>, ... <span class="bracket">}</span>
  ]
]

<span class="property">キャッシュ結果</span><span class="operator">:</span> <span class="number">3</span></pre>
                </div>
              </div>
            </div>
          </div>

          <!-- セレクターの利点 -->
          <div class="benefits">
            <div class="benefit">
              <div class="benefit-icon">🔄</div>
              <div class="benefit-content">
                <div class="benefit-title">メモ化</div>
                <div class="benefit-desc">
                  入力が変わらない限り、計算結果を再利用して不要な再計算を防ぎます。
                </div>
              </div>
            </div>
            <div class="benefit">
              <div class="benefit-icon">🧩</div>
              <div class="benefit-content">
                <div class="benefit-title">合成可能性</div>
                <div class="benefit-desc">
                  セレクターを組み合わせて、より複雑なデータ変換を構築できます。
                </div>
              </div>
            </div>
            <div class="benefit">
              <div class="benefit-icon">🔍</div>
              <div class="benefit-content">
                <div class="benefit-title">関心の分離</div>
                <div class="benefit-desc">
                  UIコンポーネントは状態の構造を知る必要がなく、必要なデータだけを取得できます。
                </div>
              </div>
            </div>
            <div class="benefit">
              <div class="benefit-icon">🧪</div>
              <div class="benefit-content">
                <div class="benefit-title">テスト容易性</div>
                <div class="benefit-desc">
                  純粋関数なのでテストが容易です。入力と出力の関係をテストするだけで済みます。
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
